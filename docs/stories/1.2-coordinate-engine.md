# Story 1.2: Implement CoordinateTransformEngine Utility

**Epic**: Epic 1 - Eliminate Circular Dependency Patterns
**Priority**: P1
**Effort**: 8 hours
**Status**: ✅ Complete

---

## User Story

As a developer,
I want a unified coordinate transformation engine,
so that plan view, elevation views, and 3D view all use consistent coordinate calculations without asymmetry.

---

## Dependencies

- ✅ Story 1.1 (types must be current)

---

## Acceptance Criteria

- [x] `CoordinateTransformEngine.ts` class created with methods:
  - [x] `planToCanvas()` - Plan view to canvas pixels
  - [x] `canvasToPlan()` - Canvas pixels to plan coordinates
  - [x] `planToElevation()` - Plan to elevation canvas (all 4 walls)
  - [x] `planTo3D()` - Plan to Three.js position (meters, centered)
  - [x] `threeJSToPlan()` - Three.js back to plan coordinates
  - [x] `validateConsistency()` - Round-trip validation
- [x] All methods have comprehensive JSDoc with coordinate system explanations
- [x] Unit tests cover all transformation methods with <0.1cm accuracy
- [x] Round-trip tests validate plan → 3D → plan with <0.1cm error
- [x] Left and right elevation views use unified calculation (mirroring at render time only)

---

## Integration Verification

- [x] IV1: Transformation methods produce identical results as current system for test cases
- [x] IV2: No performance degradation (benchmark transformations vs. current inline code)
- [x] IV3: Engine works with existing RoomDimensions interface (legacy `height` field mapping)

---

## Implementation Reference

See [circular-patterns-fix-plan.md](../circular-patterns-fix-plan.md) - Fix #1, Phase 2, Steps 2.1-2.4
See [coordinate-system-visual-guide.md](../coordinate-system-visual-guide.md) for transformation formulas

Full details: [prd.md](../prd.md) Section 4, Story 1.2

---

## Session Folder

Create: `docs/session-2025-MM-DD-story-1.2-coordinate-engine/`

---

## Completion Checklist

- [x] All Acceptance Criteria met
- [x] All Integration Verification steps passed
- [x] Unit tests written and passing
- [x] Changes committed to git
- [x] Story marked as ✅ Complete in this file
